<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Edit CSV</title>
  <link rel="stylesheet" href="https://unpkg.com/modern-css-reset/dist/reset.min.css">
  <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
</head>
<body>
  <div class="container">
    <header>
      <h1>Edit Transactions CSV</h1>
      <p class="subtitle">Append a row to an existing CSV or create a new one.</p>
    </header>

    {% with messages = get_flashed_messages() %}
      {% if messages %}
        <div class="toast">
          {% for message in messages %}
            <div class="toast-item">{{ message }}</div>
          {% endfor %}
        </div>
      {% endif %}
    {% endwith %}

    <form class="card" method="POST">
      <div class="field">
        <label for="target_csv">Target CSV</label>
        <select id="target_csv" name="target_csv">
          <option value="transactions.csv">transactions.csv (project)</option>
          {% for c in csvs %}
            {% if c.path != 'transactions.csv' %}
              <option value="{{ c.path }}">{{ c.label }}</option>
            {% endif %}
          {% endfor %}
          <option value="new">Create newâ€¦</option>
        </select>
      </div>
      <div class="field" id="new_csv_name_field" style="display:none;">
        <label for="new_csv_name">New CSV Name</label>
        <input id="new_csv_name" name="new_csv_name" type="text" placeholder="my-transactions.csv">
      </div>

      <div class="grid-2">
        <div class="field">
          <label for="type">Type</label>
          <select id="type" name="type" required>
            <option value="READING">READING</option>
            <option value="RECHARGE">RECHARGE</option>
          </select>
        </div>
        <div class="field">
          <label for="timestamp">Timestamp</label>
          <input id="timestamp" name="timestamp" type="datetime-local">
          <small>Leave blank to use current time</small>
        </div>
      </div>

      <div class="grid-2">
        <div class="field">
          <label for="tenant">Tenant</label>
          <select id="tenant" name="tenant" required>
            <option>Ground Floor</option>
            <option>First Floor</option>
            <option>Second Floor</option>
          </select>
        </div>
        <div class="field">
          <label for="reading_amount">Reading/Amount</label>
          <input id="reading_amount" name="reading_amount" type="number" step="0.01" placeholder="e.g. 1234.56">
        </div>
      </div>

      <div class="grid-2">
        <div class="field">
          <label for="consumption">Consumption</label>
          <input id="consumption" name="consumption" type="number" step="0.01" placeholder="e.g. 10.5">
        </div>
        <div class="field">
          <label for="balances">Balances</label>
          <input id="balances" name="balances" type="text" placeholder="Ground Floor: Rs.0.00; First Floor: Rs.0.00; Second Floor: Rs.0.00">
          <small>Optional; keep same format.</small>
        </div>
      </div>

      <button class="btn primary" type="submit">Add Row</button>
      <a class="btn" href="{{ url_for('index') }}">Back</a>
    </form>
  </div>

  <script>
    const select = document.getElementById('target_csv');
    const newField = document.getElementById('new_csv_name_field');
    function sync() {
      newField.style.display = select.value === 'new' ? 'block' : 'none';
    }
    select.addEventListener('change', sync);
    sync();
  </script>
</body>
</html> 